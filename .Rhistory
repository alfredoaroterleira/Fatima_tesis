#install.packages("haven")
#install.packages("dplyr")
library(haven)
library(dplyr)
lapop2014 <- read_dta("LAPOP_2014.dta")
lapop2019 <- read_dta("LAPOP_2018_2019.dta")
lapop2014 <- lapop2014 %>%
select(uniq_id, aoj22, q1, q2, l1, vic1ext, q3c)
lapop2014 <- lapop2014 %>%
rename(
ID = uniq_id,
PUNITIVO = aoj22,
SEXO = q1,
EDAD = q2,
IDEOLOGIA = l1,
VICTIMA = vic1ext,
RELIGION = q3c
)
lapop2014 <- lapop2014 %>%
mutate(
ANO = 2014
)
lapop2019 <- lapop2019 %>%
select(uniq_id, aoj22, q1, q2, l1, vic1ext, q3cn)
lapop2019 <- lapop2019 %>%
rename(
ID = uniq_id,
PUNITIVO = aoj22,
SEXO = q1,
EDAD = q2,
IDEOLOGIA = l1,
VICTIMA = vic1ext,
RELIGION = q3cn
)
lapop2019 <- lapop2019 %>%
mutate(
ANO = 2019
)
lapop <- bind_rows(lapop2014, lapop2019)
lapop_total <- lapop %>%
mutate(
# --- PUNITIVO: conservar 1 y 2; 0->1 y 1->2; otros (3, 88, 98, etc.) a NA
PUNITIVO = case_when(
PUNITIVO == 0 ~ 1,
PUNITIVO == 1 ~ 2,
PUNITIVO %in% c(1, 2) ~ PUNITIVO,
TRUE ~ NA_real_
),
# --- SEXO: 0 = mujer, 1 = hombre (si viniera 1/2, lo mapeamos a 1/0)
SEXO = case_when(
SEXO %in% c(0, 1) ~ as.numeric(SEXO),
SEXO == 1 ~ 1,       # hombre
SEXO == 2 ~ 0,       # mujer
TRUE ~ NA_real_
),
# --- VICTIMA: 1 = Sí, 2 = No  ->  1 = Sí, 0 = No
VICTIMA = case_when(
VICTIMA == 1 ~ 1,
VICTIMA == 2 ~ 0,
TRUE ~ NA_real_
),
# --- RELIGION: conservar solo estos códigos
RELIGION = ifelse(RELIGION %in% c(1,2,3,4,5,6,7,10,11,12), RELIGION, NA_real_),
# --- Numéricas
EDAD = suppressWarnings(as.numeric(EDAD)),
IDEOLOGIA = suppressWarnings(as.numeric(IDEOLOGIA)),
# --- Año categórico
ANO = factor(ANO, levels = c(2014, 2019))
) %>%
# Convertimos a factor con etiquetas numéricas (p. ej., niveles "0","1","2"...)
mutate(
PUNITIVO = factor(PUNITIVO, levels = c(1, 2)),
SEXO     = factor(SEXO,     levels = c(0, 1)),
VICTIMA  = factor(VICTIMA,  levels = c(0, 1)),
RELIGION = factor(RELIGION, levels = c(1,2,3,4,5,6,7,10,11,12))
)
View(lapop_total)
View(lapop)
# --- eliminamos NAS
lapop_total <- lapop_total %>%
filter(!is.na(PUNITIVO), !is.na(SEXO), !is.na(EDAD),
!is.na(IDEOLOGIA), !is.na(VICTIMA), !is.na(RELIGION), !is.na(ANO))
View(lapop_total)
#install.packages("haven")
#install.packages("dplyr")
library(haven)
library(dplyr)
lapop2014 <- read_dta("LAPOP_2014.dta")
lapop2019 <- read_dta("LAPOP_2018_2019.dta")
lapop2014 <- lapop2014 %>%
select(uniq_id, aoj22, q1, q2, l1, vic1ext, q3c)
lapop2014 <- lapop2014 %>%
rename(
ID = uniq_id,
PUNITIVO = aoj22,
SEXO = q1,
EDAD = q2,
IDEOLOGIA = l1,
VICTIMA = vic1ext,
RELIGION = q3c
)
lapop2014 <- lapop2014 %>%
mutate(
ANO = 2014
)
lapop2019 <- lapop2019 %>%
select(uniq_id, aoj22, q1, q2, l1, vic1ext, q3cn)
lapop2019 <- lapop2019 %>%
rename(
ID = uniq_id,
PUNITIVO = aoj22,
SEXO = q1,
EDAD = q2,
IDEOLOGIA = l1,
VICTIMA = vic1ext,
RELIGION = q3cn
)
lapop2019 <- lapop2019 %>%
mutate(
ANO = 2019
)
lapop <- bind_rows(lapop2014, lapop2019)
lapop_total <- lapop %>%
mutate(
# --- PUNITIVO: conservar 1 y 2; 0->1 y 1->2; otros (3, 88, 98, etc.) a NA
PUNITIVO = case_when(
PUNITIVO == 0 ~ 1,
PUNITIVO == 1 ~ 2,
PUNITIVO %in% c(1, 2) ~ PUNITIVO,
TRUE ~ NA_real_
),
# --- SEXO: 0 = mujer, 1 = hombre (si viniera 1/2, lo mapeamos a 1/0)
SEXO = case_when(
SEXO %in% c(0, 1) ~ as.numeric(SEXO),
SEXO == 1 ~ 1,       # hombre
SEXO == 2 ~ 0,       # mujer
TRUE ~ NA_real_
),
# --- VICTIMA: 1 = Sí, 2 = No  ->  1 = Sí, 0 = No
VICTIMA = case_when(
VICTIMA == 1 ~ 1,
VICTIMA == 2 ~ 0,
TRUE ~ NA_real_
),
# --- RELIGION: conservar solo estos códigos
RELIGION = ifelse(RELIGION %in% c(1,2,3,4,5,6,7,10,11,12), RELIGION, NA_real_),
# --- Numéricas
EDAD = suppressWarnings(as.numeric(EDAD)),
IDEOLOGIA = suppressWarnings(as.numeric(IDEOLOGIA)),
# --- Año categórico
ANO = factor(ANO, levels = c(2014, 2019))
) %>%
# Convertimos a factor con etiquetas numéricas (p. ej., niveles "0","1","2"...)
mutate(
PUNITIVO = factor(PUNITIVO, levels = c(1, 2)),
SEXO     = factor(SEXO,     levels = c(0, 1)),
VICTIMA  = factor(VICTIMA,  levels = c(0, 1)),
RELIGION = factor(RELIGION, levels = c(1,2,3,4,5,6,7,10,11,12))
)
# --- eliminamos NAS
#lapop_total <- lapop_total %>%
#  filter(!is.na(PUNITIVO), !is.na(SEXO), !is.na(EDAD),
#         !is.na(IDEOLOGIA), !is.na(VICTIMA), !is.na(RELIGION), !is.na(ANO))
View(lapop_total)
# --- eliminamos NAS
lapop_total <- lapop_total %>%
filter(!is.na(PUNITIVO), !is.na(SEXO), !is.na(EDAD),
!is.na(IDEOLOGIA), !is.na(VICTIMA), !is.na(RELIGION), !is.na(ANO))
install.packages("writexl")
# --- csv
write.csv(lapop_total, "lapop_total.csv", row.names = FALSE)
# --- excel
write.xlsx(lapop_total, "lapop_total.xlsx", row.names = FALSE)
library(haven)
library(dplyr)
library(writexl)
# --- csv
write.csv(lapop_total, "lapop_total.csv", row.names = FALSE)
# --- excel
write.xlsx(lapop_total, "lapop_total.xlsx", row.names = FALSE)
install.packages("xlsx")
library(haven)
library(dplyr)
library(xlsx)
library(haven)
library(dplyr)
library(xlsx)
install.packages("xlsx")
library(haven)
library(dplyr)
library(xlsx)
install.packages("openxlsx")
library(haven)
library(dplyr)
library(openxlsx)
# --- csv
write.csv(lapop_total, "lapop_total.csv", row.names = FALSE)
# --- excel
write.xlsx(lapop_total, "lapop_total.xlsx", rowNames = FALSE)
library(haven)
library(dplyr)
library(openxlsx)
library(tidyr)
library(haven)
library(dplyr)
library(openxlsx)
library(tidyr)
lapop2014 <- read_dta("LAPOP_2014.dta")
lapop2019 <- read_dta("LAPOP_2018_2019.dta")
lapop2014 <- lapop2014 %>%
select(uniq_id, aoj22, q1, q2, l1, vic1ext, q3c)
lapop2014 <- lapop2014 %>%
rename(
ID = uniq_id,
PUNITIVO = aoj22,
SEXO = q1,
EDAD = q2,
IDEOLOGIA = l1,
VICTIMA = vic1ext,
RELIGION = q3c
)
lapop2014 <- lapop2014 %>%
mutate(
ANO = 2014
)
lapop2019 <- lapop2019 %>%
select(uniq_id, aoj22, q1, q2, l1, vic1ext, q3cn)
lapop2019 <- lapop2019 %>%
rename(
ID = uniq_id,
PUNITIVO = aoj22,
SEXO = q1,
EDAD = q2,
IDEOLOGIA = l1,
VICTIMA = vic1ext,
RELIGION = q3cn
)
lapop2019 <- lapop2019 %>%
mutate(
ANO = 2019
)
lapop <- bind_rows(lapop2014, lapop2019)
lapop_total <- lapop %>%
# 1) Seleccionar solo las variables que necesitas
select(ID, PUNITIVO, SEXO, EDAD, IDEOLOGIA, VICTIMA, RELIGION, ANO) %>%
# 2) Aplicar filtros
filter(
PUNITIVO %in% c(1, 2),
VICTIMA  %in% c(1, 2),
RELIGION %in% c(1, 2, 3, 4, 5, 6, 7, 10, 11, 12)
) %>%
# 3) Recodificación de variables
mutate(
# Binarias a 0/1
PUNITIVO = recode(PUNITIVO, `1` = 0, `2` = 1),
SEXO     = recode(SEXO,     `2` = 0, `1` = 1),
VICTIMA  = recode(VICTIMA,  `1` = 1, `2` = 0),
# Reindexar RELIGION para que no haya saltos
RELIGION_reindex = case_match(
RELIGION,
1  ~ 1,  2 ~ 2,  3 ~ 3,  4 ~ 4,  5 ~ 5,
6  ~ 6,  7 ~ 7,
10 ~ 8,  11 ~ 9,  12 ~ 10,
.default = NA_integer_
),
# Convertir a factor categórico pero con números como etiquetas
RELIGION = factor(
RELIGION_reindex,
levels = 1:10,
labels = as.character(1:10),
ordered = TRUE
)
) %>%
select(-RELIGION_reindex) %>%
# 4) Eliminar NAs
drop_na(ID, PUNITIVO, SEXO, EDAD, IDEOLOGIA, VICTIMA, RELIGION, ANO)
lapop_total <- lapop %>%
# 1) Nos quedamos con las columnas necesarias
select(ID, PUNITIVO, SEXO, EDAD, IDEOLOGIA, VICTIMA, RELIGION, ANO) %>%
# 2) Convertimos haven_labelled -> numeric (códigos)
mutate(
PUNITIVO_num = as.numeric(PUNITIVO),
SEXO_num     = as.numeric(SEXO),
VICTIMA_num  = as.numeric(VICTIMA),
RELIGION_num = as.numeric(RELIGION),
IDEOLOGIA    = as.numeric(IDEOLOGIA)  # la mantenemos numérica, solo quitamos la clase 'labelled'
) %>%
# 3) Aplicar filtros con los códigos numéricos
filter(
PUNITIVO_num %in% c(1, 2),
VICTIMA_num  %in% c(1, 2),
RELIGION_num %in% c(1, 2, 3, 4, 5, 6, 7, 10, 11, 12)
) %>%
# 4) Recodificaciones y construcción final
mutate(
# Binarias a 0/1 según tu regla
PUNITIVO_bin = if_else(PUNITIVO_num == 1, 0L,
if_else(PUNITIVO_num == 2, 1L, NA_integer_)),
SEXO_bin     = if_else(SEXO_num == 2, 0L,
if_else(SEXO_num == 1, 1L, NA_integer_)),
VICTIMA_bin  = if_else(VICTIMA_num == 1, 1L,
if_else(VICTIMA_num == 2, 0L, NA_integer_)),
# Reindexar RELIGION (10->8, 11->9, 12->10)
RELIGION_reindex = dplyr::case_match(
RELIGION_num,
1  ~ 1L,  2 ~ 2L,  3 ~ 3L,  4 ~ 4L,  5 ~ 5L,
6  ~ 6L,  7 ~ 7L,
10 ~ 8L,  11 ~ 9L, 12 ~ 10L,
.default = NA_integer_
),
# Convertimos a factores categóricos (mostrando números)
PUNITIVO = factor(PUNITIVO_bin, levels = c(0, 1), labels = c("0", "1")),
SEXO     = factor(SEXO_bin,     levels = c(0, 1), labels = c("0", "1")),
VICTIMA  = factor(VICTIMA_bin,  levels = c(0, 1), labels = c("0", "1")),
# RELIGION: factor categórico ordenado con etiquetas numéricas 1..10 (sin saltos)
RELIGION = factor(
RELIGION_reindex,
levels = 1:10,
labels = as.character(1:10),
ordered = TRUE
)
) %>%
# 5) Dejamos solo las columnas finales con los nombres originales pedidos
transmute(
ID,
PUNITIVO,
SEXO,
EDAD,
IDEOLOGIA,   # se mantiene numérica
VICTIMA,
RELIGION,
ANO
) %>%
# 6) Eliminar NAs
drop_na(ID, PUNITIVO, SEXO, EDAD, IDEOLOGIA, VICTIMA, RELIGION, ANO)
View(lapop_total)
# --- csv
write.csv(lapop_total, "lapop_total.csv", row.names = FALSE)
# --- excel
write.xlsx(lapop_total, "lapop_total.xlsx", rowNames = FALSE)
